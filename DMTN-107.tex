\documentclass[DM,toc]{lsstdoc}
\usepackage{graphicx}
\usepackage{url}
\usepackage{latexsym}
\usepackage{color}
\usepackage{enumitem}

\title[Alert Production in Year 1]{Options for Alert Production in \\ LSST Operations Year 1}

\author{M.~L.~Graham, E.~C.~Bellm, C.~T.~Slater, L.~P.~Guy, \\ and the DM System Science Team}

\setDocRef{DMTN-107}
\date{\today}
\setDocUpstreamLocation{\url{}}

\setDocAbstract{
This document reviews five options for alert production in LSST Operations Year 1 (LOY1), taking into account any implications on LSST formal requirements including up-scopes, down-scopes or explicit violations. 
The Data Management System Science Team's preferred option for maximizing LSST science is to generate template images from as much of the data from the commissioning and/or science verification phases as possible and use them to run Difference Image Analysis and alert production during LOY1. 
A proposal to increase the sky area covered during commissioning via a "filler" scheduler program is also presented.
As a potential moderate up-scope, this study presents an option to build interim templates on a $\sim$monthly basis during LOY1, which could increase the accessible sky area by $\sim$1000-2000 $\rm deg^2$ per month, and should be reconsidered closer to the start of Operations. 
}

\setDocChangeRecord{%
\addtohist{0}{2019-03-28}{Internal working document.}{Melissa Graham}
\addtohist{0.1}{2019-04-24}{Review.}{Leanne Guy}
\addtohist{1}{2019-05-07}{Reviewed by co-authors, ready for circulation.}{Melissa Graham}
\addtohist{1.1}{2019-06-03}{Added DMS-REQ-0271,0274 to S.2.2.}{Melissa Graham}
\addtohist{1.2}{2020-04-14}{Updated to account for the changed plans for LSST commissioning (Jira ticket DM-22193).}{Melissa Graham}
}

\begin{document}

\maketitle

\section{Introduction} \label{sec:intro}

One of the four science pillars of LSST is time-domain astronomy, which is enabled by alerts on LSST detections of transient, variable, and/or moving objects. Alerts are the only data product that will be immediately available (within $60$ seconds of image readout) and publicly shareable (not subject to a proprietary period; \citeds{LSE-163}).
The worldwide community is --- and has been for a while --- actively preparing to process the LSST alert stream and use it to generate groundbreaking scientific results. 

Alerts are produced by the LSST Prompt pipelines via Difference Imaging Analysis (DIA), which creates difference images by subtracting a template image from each new image, and then identifies sources in the difference image.
Template images are not just any other image of the same field; they are generated by stacking previous images in such a way as to "remove" the flux of any transient or moving objects and "standardize" the flux of variable objects.
Using deep stacks as a template also minimizes the amount of noise that it contributes to the difference image (e.g., \citeds{DMTN-006,DMTN-021}).
For the LSST, template images will either be generated for a range of airmass, or be subjected to a model correction for airmass, in order to mitigate the effects of differential chromatic refraction (DCR; \citeds{DMTN-037}).

During LOY1 there will not be many pre-existing LSST images from which to build templates\footnote{Building templates from other instrument's images is considered fully out of scope and not included in this study}.
The current plans for commissioning would enable template generation over some fraction of the wide-fast-deep (WFD) survey area (\citeds{LSE-79}).
During operations, images for template generation will be generated during the annual Data Release (DR) processing, which is scheduled to begin at $0.5$ years (DR1), at $1$ year (DR2), and on a yearly basis thereafter (LSO-011).
It is currently undefined how DIA in Prompt processing --- and thus alert production --- should proceed in LOY1.
The ability of the Data Management System (DMS) to produce alerts during LOY1 depends on the fraction of the WFD survey area covered during LSST commissioning, and the ability to increase that area depends on the processing latency for DR1, which might not finish before the end of LOY1 (LSO-011).

{\bf Therefore, the role of this document} is to review the formal requirements regarding alert production during LOY1 (\S~\ref{sec:req}), and to propose and assess all possible approaches to alert production in LOY1 (\S~\ref{sec:potsol}), with the goal of maximizing LSST science. A summary of the pros and cons of the various options, as well as the DM System Science Team preferred option for maximizing LSST science is provided in (\S~\ref{sec:rec}).


\clearpage
\section{The Relevant Requirements, Specifications, and Plans}\label{sec:req}

The existing formal requirements on alert production, alert packet contents, and template images are described below.
Five options for alert production in LOY1, presented in \S~\ref{sec:potsol}, will each be assessed with respect to these requirements.

\subsection{Alert Production}\label{ssec:req_ap}

The Science Requirements Document \citeds{LPM-17} states in Section 3.5 Data Processing and Management Requirements, that the prompt processing {\it "data products are generated continuously every observing night, including alerts to objects that have changed brightness or position"}. 
The introductory paragraph of this section also states: {\it "Detailed requirements on data processing and management will be described in the LSST System Requirements Document. Here, only a rough guidance is provided."} For this reason, we do not consider the \citeds{LPM-17} statement on nightly alert generation be a hard requirement that alerts be generated during LOY1, prior to the availability of the necessary templates. 

The LSST Observatory System Specifications document \citeds{LSE-30} details formal requirements\reqparam{sciVisitAlertDelay}\reqparam{sciVisitAlertFailure}\ossreq{0112} on the fraction of science visits that experience delayed and failed alert production, but these only apply when alert production is {\em possible} for a visit (i.e., when a suitable template exists).

There are also formal requirements that the DMS derive and supply threshold values\reqparam{transSampleSNR}\reqparam{transCompletenessMin}\reqparam{transPurityMin}\ossreq{0353} for a spuriousness parameter (a real/bogus score for each difference image source), which can be used to filter the alert stream into a subsample of transient and variable objects with a given completeness and purity\footnote{See also OSS-REQ-0354 for the required parameters for a subsample of transient and variable objects \citeds{LSE-30}.}.
Substantial changes to the template images (i.e., in depth or stacking algorithm) may require that the real/bogus algorithm be retrained, and the spuriousness threshold parameters be reevaluated, in order to meet these formal requirements on the DMS. 

\subsection{Alert Packet Contents}\label{ssec:req_apc}

\citeds{LSE-61} contains a formal requirement that the alert packets include {\em at least} a 12 month history (if available), as well as cutouts of the template and difference images\dmreq{0274}.
The availability of the 12 month history and the cutouts are also discussed in Section 3.5.1 of \citeds{LSE-163}.
The 12 month history would not be available in LOY1, and the requirement adequately accounts for this, so it would not be violated in LOY1.
Alerts issued without corresponding image cutouts being made available, either as part of the alert packet or via an alternative distribution mechanism, would violate this requirement.

\citeds{LSE-61} contains a formal requirement that the variability characterization parameters in an alert packet be based on data collected during {\em at least} the past year\reqparam{diaCharacterizationCutoff}\dmreq{0319}.
In LOY1, releasing variability characterization parameters in the alerts that have been calculated with $<1$ year of data would, technically, be in violation of this requirement.
However, that is unavoidable no matter which option for alert production in LOY1 is adopted.

\citeds{LSE-61} contains a formal requirement that all DIAObjects shall include identifiers of the nearest three stars and three galaxies from the Data Release Objects catalog\dmreq{0271}, and these DIAObject records will be included in the alert packet\dmreq{0274}.
Prior to the generation of DR1 in LOY1 this requirement cannot be met, and the alert packets will not contain associations to LSST DR Objects.
As in the above paragraph, this is unavoidable no matter which option for alert production in LOY1 is adopted.

\subsection{Template Generation}\label{ssec:req_temp}

There are formal requirements\ossreq{0158}\reqparam{templateNoiseLevelY1}\reqparam{templateNoiseLevelY2} on the depth of a template image to be used in DIA, which are expressed as constraints on the fraction ($f$) of the noise that a template may contribute to the difference image: $f_{\rm Y1}=0.4$ in year 1, and $f=0.2$ thereafter.
This requirement specifies that the variance of the difference image ($\sigma_{\rm diff}^2$) and the variance of a single science image ($\sigma_{\rm sci}^2$) shall be related as: $\sigma_{\rm diff}^2 \leq (1+f)\sigma_{\rm sci}^2$.
The variance of the reference (template) image is $\sigma_{\rm ref}^2 = \frac{1}{N} \sigma_{\rm sci}^2$, where $N$ is the number of science images combined to create the reference image.
Since $\sigma_{\rm diff}^2 = \sigma_{\rm ref}^2 + \sigma_{\rm sci}^2$, we arrive at the expression $N \geq \frac{1}{f}$.
During LOY1, $N_{\rm Y1} \geq \frac{1}{f_{\rm Y1}} = 2.5$ and during the remaining years of the survey, $N \geq 5$ images.
This is a {\em theoretical} minimum number of images from which the template should be built, but it is worth noting that this minimum of $5$ images for a template matches the minimum number images per year for the least-sampled filter of the WFD main survey, $u$-band \citep{Ivezi__2019}.
In the context of this DMTN, we use a baseline of $\sim$3 visits to estimate the area of sky that could be covered by templates from, e.g., the commissioning surveys, during LOY1.
It is important to note that the training and science validation of the real/bogus algorithm discussed in \S~\ref{ssec:req_ap} will determine when alert production will be able to provide thresholds which meet the completeness and purity requirements (section 2.1), and that this is not solely or directly dependent on the template image depth.

There are two additional template-related policies which are relevant to this discussion, but which do not pose any potential problems for alert production options in LOY1.
The first is that \citeds{LSE-61} requires that the range of epochs which may contribute to a template image is limited to no more than 1 year\reqparam{templateMaxTimespan}\dmreq{0280}.
This does not pose a potential problem to LOY1 alerts because creating template images from $<$1 year's worth of epochs is not in violation of this requirement.
The second is that \citeds{LDM-151} states that TemplateCoadd images should be within a default $2$ years of the current CalExp image which is about to undergo DIA (Section 3.2.3 of \cite{LDM-151}).
This does not pose a problem since any template used in DIA during LOY1 will have been obtained within 2 years.

During LSST Operations the production of template images ({\tt TemplateCoadds}) is planned to occur during Data Release processing (Section 5, \citeds{LDM-151}); however, some fraction of the WFD main survey area will be imaged during commissioning (\S~\ref{ssec:potsol_comm}).
Processing for Data Release 1 (DR1), which will be based on the first six months of data, is expected to begin halfway through LOY1, and DR2, which will be based the first 12 months of data, is expected to begin at the end of LOY1 .
Processing is not instantaneous and will take several months; DR1 is expected to be released one year after the start of operations, and DR2 towards the end of LOY2 (LSO-011).
This is echoed in the Plans and Policies for Alert Generation and Distribution document, which states that {\it "Due to the need for Data-Release-derived templates, Alert Production cannot run at full scale and full fidelity during commissioning and the first year of operations"} (Section 2.2.1, \citeds{LDM-612}). 

The method of template generation might also influence the quantity of alerts that could be produced in LOY1.
\citeds{LDM-151} specifies that in order to use a template image in DIA, it must satisfy one of two conditions in order to mitigate the effects of differential chromatic refraction (DCR).
It must either (1) match the position and spatial extent of the new image and have been generated from images with a similar airmass and parallactic angle, {\em or} (2) have been generated with the inclusion of a model that accounts for DCR (\citeds{LDM-151}).
The former would be more restrictive on the area of sky with viable templates for use in LOY1.

\clearpage
\section{Options for Alert Production in LOY1}\label{sec:potsol}

The potential solutions considered herein are:
\begin{enumerate}
\item {\bf Do nothing.} Do not generate alerts prior to the release of DR1 (which is expected to be released one year after the start of operations).
\item {\bf Build templates from commissioning and/or science verification data} obtained with the LSST camera by the start of LOY1. Generate alerts if and when a template exists for a field. (At minimum, use templates already built as a part of science verification).
\item {\bf Build templates with LOY1 data} on a, e.g., $\sim$monthly basis. Generate alerts if and when a template exists for a field. This option could be done in addition to the previous option.
\item {\bf Do not build templates. Instead, use image-image differencing} to generate alerts if and when a prior image exists for a field.
\item {\bf Do not build templates. Do not use DIA. Instead, generate alerts for all new point sources}, or cataloged point sources which have changed in brightness by more than some threshold since the last image ("catalog differencing").
\end{enumerate}

These are each discussed in more detail in the following sections.
The main aspects of each option to consider are outlined in the following table:
\begin{center}
\begin{tabular}{|p{2.5cm}|p{13cm}|}
\hline
Scope & Does the option require an expansion of scope in terms of software development, computational processing, or full-time equivalent (FTE) hours? \\
\hline
Risks & Does the option impose any risks on the the ability of the observatory or DM systems to deliver LSST science?  \\
\hline
Requirements & Does the option violate any written requirements or specifications? \\
\hline
Consistency & Does the option cause the content or format of the template images or alerts in LOY1 to be different, compared to the rest of the survey? \\ 
\hline
Science & Does the option maximize time-domain science in LOY1? \\
\hline
\end{tabular}
\end{center} 

Regarding the "Science" category, in this document we consider "maximizing time-domain science in LOY1" to mean maximizing the number of alerts {\em for unique objects} that are produced with the same content as DM's formal plans (e.g., difference-image fluxes, spuriousness parameters).
However, "maximizing science" could also be interpreted as providing as much LSST data for each object as possible, e.g., more filters and/or epochs per unique object, as discussed in \S~\ref{sssec:potsol_comm_r}.

\clearpage
\subsection{Do Nothing}\label{ssec:potsol_donothing}

{\bf Do nothing. Do not generate alerts prior to the release of DR1 (one year after the start of operations).}

\begin{center}
\begin{tabular}{|p{2.5cm}|p{13cm}|}
\hline
Scope & \textcolor{blue}{No expansion of DM scope.} \\
\hline
Risks & \textcolor{orange}{Potential risks for the DMS.} \\
\hline
Requirements & \textcolor{orange}{Not fully consistent with the high-level SRD requirement, but does not strictly represent a violation.} \\
\hline
Consistency & \textcolor{red}{Does not provide consistent data products.} \\
\hline
Science & \textcolor{red}{No science from alerts (or any DIA product) until after DR1.} \\
\hline
\end{tabular}
\end{center}

\textcolor{blue}{ Scope -- No expansion of DM scope.} 
Although this option is not a reduction of DM scope, it is likely be perceived as a as a degradation of the survey by the community and will certainly fall below their expectations.

As an additional note, LSST Education and Public Outreach (EPO) are not expecting to serve alerts to the community prior to Data Release 1 and the beginning of LSST Alert Stream production (\citeds{LEP-031}), and so this option would not have any scope implications for EPO. 

\textcolor{orange}{ Risks -- Potential risks for the DMS.}
There is a risk to DM in missing the opportunity to learn lessons from running alert production in LOY1
and imposes a higher risk on alert production when it finally does start in year 2.
There is another risk to the DMS: it is likely that the community will do ad-hoc template generation, DIA and/or alert production with user-generated pipelines based on the processed standard-visit images released within 24 hours\reqparam{L1PublicT}\lsrreq{0104} in order to get early science and publications.
This might cause additional load on the user computational processing resources available through the Science Platform, especially if multiple user groups attempt to compete in this regard (which seems likely).

\textcolor{orange}{ Requirements -- Not consistent with high-level SRD requirements.}
As described in Section \ref{ssec:req_ap}, the SRD states that it provides {\it rough guidance}, rather than a strict requirement, that alerts be generated continuously every observing night (\citeds{LPM-17}). 
While it is unavoidable that there be some areas without template images during LOY1, and thus also without alerts, the option to not generate {\it any} alerts in LOY1 is clearly not in the spirit of the SRD requirements, and would certainly not meet the science community's expectations. 

\textcolor{red}{ Consistency -- Does not provide consistent data products.}
To not produce any alerts --- or any DIA Prompt products --- in LOY1 would be inconsistent with the other 9 years of the LSST Main Survey.
Furthermore, this inconsistency might impose a large down-time on the community brokers, which could impede their ability to commission their systems and/or to garner and maintain funding.
Note that the alerts released during LSST commissioning are not required to have the same latency, format, contents, and/or distribution mechanism as required in operations, which might inhibit broker commissioning;  brokers will likely be looking to alerts in LOY1 to fullfill this need.

\textcolor{red}{ Science -- No science from alerts (or any DIA product) until after DR1.}
If LSST is not going to do any difference imaging in LOY1, this would prohibit science that requires light curves with any underlying source (extended or point) subtracted, such as supernovae.
Time-domain science with, e.g., variable stars, AGN, and moving objects would likely proceed using direct image source catalogs. 


\clearpage
\subsection{Build Templates from Commissioning Data}\label{ssec:potsol_comm}

{\bf Build templates from commissioning and/or science verification data obtained with the LSST camera\footnote{I.e., the full LSSTCam and not the single-raft ComCam which precedes it.} by the start of LOY1. Generate alerts if and when a template exists for a field.} At minimum, use templates already built as a part of science verification.

\begin{center}
\begin{tabular}{|p{2.5cm}|p{13cm}|}
\hline
Scope & \textcolor{orange}{Potential minor expansion of DM scope.}   \\
\hline
Risks & \textcolor{blue}{No risk for the observatory or the DMS.} \\
\hline
Requirements & \textcolor{blue}{Does not violate any formal requirements.} \\
\hline
Consistency & \textcolor{blue}{Provides somewhat consistent data products.}  \\
\hline
Science & \textcolor{orange}{Enables some science from DIA and alerts in LOY1.} \\
\hline
\end{tabular}
\end{center}

\textcolor{orange}{ Scope -- Potential minor expansion of DM scope.} 
The commissioning and science verification plans include building template images to test DIA and alert generation in the Prompt pipeline.
These templates could be used for DIA during LOY1, and that would not constitute an expansion of scope.
However, to maximize the depth and areal coverage of available templates at the start of LOY1, DM could build new templates from {\em as much} of the commissioning data as possible.
Building new templates would constitute a minor expansion of DM scope in terms of processing and FTE.
Either of these options for using commissioning data might also lead to a small increase in the scope because it introduces the opportunity to optimize the commissioning survey areas for template-building, which would require additional time for study, debate, and decision-making.
Preliminary considerations for optimizing science with commissioning-data templates is discussed further in Section \ref{sssec:potsol_comm_r}.

\textcolor{blue}{ Risks -- No risk for the observatory or the DMS.}
As with the option in \S~\ref{ssec:potsol_donothing} to Do Nothing, if LSST does not make use of {\em all} commissioning data to generate templates and run DIA then there may be members of the community who run user-generated pipelines to do so.
This might cause additional load on the users' computational resources.
This is much less likely to happen than in the scenario in which no alerts are produced.

\textcolor{blue}{ Requirements -- Does not violate any formal requirements.}
Although there are formal requirements which state that the alert contents must contain {\em at least} a 12-month history and that the variability characterization parameters be based on data from {\em at least} the past year, the correct interpretation of these requirements is that this historical data be included {\em when it exists}.
Therefore, releasing alerts with $<$1 year of history during LOY1 should not be construed as a violation of the alert content requirements.

\textcolor{blue}{ Consistency -- Provides somewhat consistent data products.}
The DIA data products that are enabled by commissioning templates would be {\em mostly} consistent in terms of contents, format, and quality, but inconsistent in terms of area covered (and the alert stream might not be continuous, as there would be no alerts for visits without existing templates).
Prior to DR1 no alert packets would have an association with LSST static-sky objects (i.e., no potential host galaxy/star information), but it is not a formal requirement that such associations be included in the alert packet, and this situation is unavoidable for all options for alert production prior to DR1.
One other potential inconsistency is that when all of the images used to generate a template are from a short time window it is impossible to fully "remove" the flux of any transient or moving objects and "standardize" the flux of variable objects; this would not be an issue with DIA data products later in the survey.

\textcolor{orange}{ Science -- Enables some science from DIA and alerts in LOY1.}
This option would enable some science to be done with Prompt data products in the sky areas covered by templates.
For example, if templates are built for $\sim10\%$ of the WFD main survey area in all filters, the LSST alert stream would provide an average of 1 million alerts per night (i.e., $\sim10\%$ of the full-survey volume; \citeds{DMTN-102}).
Preliminary considerations for optimizing science with commissioning-data templates is discussed further in Section \ref{sssec:potsol_comm_r}.



\clearpage
\subsubsection{Optimizing Science with Commissioning-Data Templates}\label{sssec:potsol_comm_r}

The plans for LSST commissioning surveys are described in \citeds{LSE-79}.
When this Tech Note was written, \citeds{LSE-79} described Final Science Verification Mini-Survey 1 in two phases.
First, a three week survey of $\sim10\%$ of the LSST WFD main survey area ($\sim$1600 $\rm deg^2$) with $\sim$15 visits per filter per field ($\sim$1 year equivalent depth), from which template images are generated.
Then, after a six-week gap, the same three week survey is executed and data is processed with the Prompt pipeline to perform DIA and generate alerts (which might be distributed with high latency via non-streaming interfaces).
If Mini-Survey 1 is executed prior to the start of operations, then multi-band templates for $\sim$1600 $\rm deg^2$ ($\sim$10\% of WFD) would already exist and could be used for alert generation in LOY1.
\citeds{LSE-79} also described Mini-Survey 2 as $\sim$300 $\rm deg^2$ to a 10-year equivalent depth, and a $\sim$100 $\rm deg^2$ 20-year Depth Test as part of Early Science Verification.
Additional sky area would be observed as a part of the other Key Performance Metrics during Early Science Verification.
{\bf The main takeaway is that \citeds{LSE-79} described that {\it at least} $\sim14\%$ of the WFD main survey area could have six-filter templates at the start of LOY1.}

The ability to generate six-filter templates and distribute alerts during LOY1 over $14\%$ of the WFD area would enable some science, but would not maximize it under this Tech Note's working definition of maximizing the number of alerts for unique objects in LOY1.
There are two options for increasing this area -- and thus the number of LOY1 alerts -- prior to the start of operations: (1) dedicate commissioning time to a template-building survey, or (2) create a template-building program for the observation scheduler which can run as "filler" during commissioning.

{\bf (1) The Feasibility of a Dedicated Template-Building Survey Prior to Operations}\\
Significantly increasing the sky area with templates by observing additional areas during the already very busy commissioning phase is probably not be feasible.
%For example, while it might be possible to cover $\sim50\%$ of the WFD area with one image per filter per field in $\sim$6 photometric nights worth of observing, single-image depth is insufficient for templates (\S~\ref{ssec:req_temp} and \ref{ssec:potsol_imgimg}).
For example, it might be possible to cover $\sim$50\% of the WFD area with $3$ images per field in a single filter in $\sim$3 photometric nights, which should be sufficient to build template images that meet the noise contribution requirement\ossreq{0158}\reqparam{templateNoiseLevelY1} for LSST year 1 (\S~\ref{ssec:req_temp}).
However, that is a very idealized minimum time estimate, which assumes 1000 visits per night and does not account for weather or dithering, factors which would $\sim$double the time estimate.
Furthermore, such a survey dedicated to template-building might not serve an independent commissioning-related purpose that would make it worth spending (potentially limited) commissioning time on, and priorities would need to be considered.

{\bf (2) A Template-Building "Filler" Program During Commissioning}\\
During commissioning, whenever activities that require images be taken but are agnostic about their location and filter (e.g., testing telescope parameters, or troubleshooting scenarios), and a filter change and/or telescope slew would not cause an unacceptable overhead or risk (at the discretion of the commissioning team), then obtain images that would be beneficial to building templates for LOY1 alert production.
An observation scheduler program could be written so that this happens automatically whenever the commissioning team chooses this "Template-Building" mode, and the program could optimize achieving, e.g., $>$3 images in good conditions in a single-filter across as wide an area as possible.
It is feasible that the equivalent of $\sim$6 photometric nights' worth of time out of LSSTCam commissioning might be spent in this mode, and as described above this could lead to fully filled single-band templates for $\gtrsim$50\% of the WFD main survey area.

{\bf The broader question of what it means to "optimize science".} \\
For the purposes of this Tech Note we have considered "maximizing science" as being equivalent to "maximizing the number of alerts for unique objects".
Under this assumption, the priority for template-building during commissioning would be to build single-filter templates over as wide an area as possible.
The optimal filter debatable: it's likely to be $r$ or $i$-band, and the latter might have the advantage of not requiring airmass correction for DCR (Section 5.2.4 of \citeds{LDM-151}).
Many surveys have done single-band transient searches in the past with much success (e.g., PTF extragalactic focused on $r$-band). 

However, the science community might instead prefer to have more {\em information} from LSST for each unique object, and prefer the prioritization of multi-band templates over sky area. 
Furthermore, the rejection of false positives would be aided by multi-filter alert distribution, especially in the early stages as the real-bogus classifier is building up an adequate training set, which would also help to "maximize science".
A time-average of $\sim$1 million alerts per night from $\sim$10\% of the WFD area will still be a huge increase for the science community to handle, and follow-up resources will be limited.
{\bf Further study -- including feedback from the science community -- is required in order to determine how to prioritize the observing strategy for template-building.}
These studies should consider whether to prioritize building templates in galactic or extragalactic fields; for example, galactic variable-star science can still be done with the direct images (although this is more difficult for very crowded fields), but extragalactic transients in extended host galaxies absolutely require image subtraction for detection and analysis.
These studies should also consider the observing strategy for LOY1 if templates will be generated on a, e.g., $\sim$monthly basis as proposed in \S~\ref{ssec:potsol_cont}.
Since the first version of this Tech Note, several of the Science Collaborations have begun to compile their science-based recommendations for templates and alerts during LOY1; the Transients and Variable Stars SC has two AAS research notes based on time critical and non-time critical science, \citet{2020RNAAS...4...41S} and \citet{2020RNAAS...4...40H}, and the Solar System SC has a white paper describing their plans for high-impact time-domain science in year one\footnote{Schwamb et al. (2020), \url{http://lsst-sssc.github.io/Files/lsst_templates.pdf}}.



\clearpage
\subsection{Build Templates with LOY1 Data}\label{ssec:potsol_cont}

{\bf Build templates with LOY1 data on a, e.g., $\sim$monthly basis. Generate alerts if and when a template image exists for a field.} This option is an extension of building templates with commissioning data (\S~\ref{ssec:potsol_comm}).

\begin{center}
\begin{tabular}{|p{2.5cm}|p{13cm}|}
\hline
Scope & \textcolor{orange}{Moderate expansion of scope.} \\
\hline
Risks & \textcolor{blue}{No risk for the observatory or the DMS.} \\
\hline
Requirements & \textcolor{blue}{Does not violate any formal requirements.} \\
\hline
Consistency & \textcolor{blue}{Provides somewhat consistent data products.} \\
\hline
Science & \textcolor{orange}{Enables some science from DIA and alerts in LOY1.} \\
\hline
\end{tabular}
\end{center}

\textcolor{orange}{ Scope -- Moderate expansion of scope.}
Since the current DM processing plans are to build templates once during the yearly data release processing effort, it would be a small expansion of scope in terms of computational processing and FTE to evaluate recently obtained data, and generate and validate new template images, on a $\sim$monthly basis prior to DR1.
The additional processing resources to stack $\sim$3 images per field over the new $\sim$1000--2000 square degrees obtained each month would likely fit into existing compute budgets, as would the fractional FTE required to generate and validate templates (as it would be part of DM's activities during LOY1 anyway).
This option might also increase the scope of the observing strategy committee, as decisions about whether to optimize the early LOY1 observations for template-building and alert production would require additional simulations, analysis, and debate.
This plan would have to be well communicated so that the science community could, e.g., optimize their plans for follow-up as new areas are added to alert production and the average number of alerts per night increases on a $\sim$monthly basis.

\textcolor{blue}{ Risks -- No risk for the observatory or the DMS,} as in \S~\ref{ssec:potsol_comm}. 

\textcolor{blue}{ Requirements -- Does not violate any formal requirements,} as in \S~\ref{ssec:potsol_comm}. 

\textcolor{blue}{ Consistency -- Provides somewhat consistent data products,} in the same way as \S~\ref{ssec:potsol_comm}.
The simplest implementation of this option would be to generate templates for a given area only one time (i.e., when $\sim$3 images have been obtained), but another is to continually improve the templates as more data is obtained (e.g., to fill in gaps left by dithering).
In the latter case, template images that are {\em updated} during LOY1 may cause a step-function in the light curve histories of some difference-image sources if, for example, there was some residual transient flux in one of the templates.
However, this may happen during the later years of Operations when templates are updated with each DR, so that is not a true inconsistency.

\textcolor{orange}{ Science -- Enables some science from DIA and alerts in LOY1,} as in \S~\ref{ssec:potsol_comm} but potentially expanding by up to 2000 $\rm deg^2$ per month.
If obtaining and building template coadded images during commissioning (\S~\ref{ssec:potsol_comm} and \ref{sssec:potsol_comm_r}) and LOY1 is prioritized, it might be possible to achieve $\sim100\%$ sky coverage in at least one filter by mid-LOY1.



\clearpage
\subsection{Image-Image Differencing}\label{ssec:potsol_imgimg}

{\bf Do not build templates. Instead, use image-image differencing to generate alerts if and when a prior image exists for a field.}

\begin{center}
\begin{tabular}{|p{2.5cm}|p{13cm}|}
\hline
Scope & \textcolor{red}{Expansion of scope.} \\
\hline
Risks & \textcolor{orange}{Potential risks for the DMS.} \\
\hline
Requirements & \textcolor{red}{Violates some formal requirements.} \\
\hline
Consistency & \textcolor{red}{Does not provide consistent data products.} \\
\hline
Science & \textcolor{orange}{Enables some science from DIA and alerts in LOY1.} \\
\hline
\end{tabular}
\end{center}

\textcolor{red}{ Scope -- Expansion of scope.}
While performing image-image differencing may be possible with the existing science pipelines, the modifications, testing, and validation necessary to release DIA data products generated with image-image differencing would constitute a major expansion of scope for DM (in terms of both FTE and the computation processing required to, for example, train real/bogus for a diverse range of template quality).
Furthermore, this option might only be feasible if the survey adopts fixed fields, such that the image-image overlap area is always a substantial fraction.
Without fixed field, images would have to be reconstructed into single-visit "templates" with the same area as each new image.
This might be possible with the existing science pipelines or might constitute an expansion of scope for DM.

\textcolor{orange}{ Potential risks for the DMS.}
This option might requires development of software unbound by formal requirements and might impose additional loads on the computational resources.
Furthermore, as in \S~\ref{ssec:potsol_donothing} this option might inspire the community to run user-generated pipelines to build templates for subtraction, which could cause additional load on resources.

\textcolor{red}{ Requirements -- Violates some formal requirements.}
Using a same-depth single-image as a template results in significantly noisier difference images (as incidentally demonstrated by \citeds{DMTN-006}), and would be in violation of the requirement\ossreq{0158}\reqparam{templateNoiseLevelY1} that the template may contribute no more than 40\% of the noise in the difference image during LOY1.
Using single-image templates might also compromise or complicate DM's ability to fulfill the formal requirement\ossreq{0353}\reqparam{transSampleSNR}\reqparam{transCompletenessMin}\reqparam{transPurityMin} that spuriousness (real/bogus) threshold values must be supplied in order to filter alerts down to subsamples of known completeness and purity.
I.e., such threshold values depend on the quality of the template image, and using single-image templates would cause a wide dispersion in template quality.

\textcolor{red}{ Consistency -- Does not provide consistent data products.}
The DIA data products such as difference-image flux (and associated parameters) would be fundamentally different from other years if DIA in LOY1 is not done with a "transient-free" template image.
Furthermore, real/bogus training would be more complicated without a consistent set of template images and the purity and completeness levels of the alert stream would not be consistent in LOY1 (in area or over time).

\textcolor{orange}{ Science -- Enables some science from DIA and alerts in LOY1.}
Although this option could yield the maximum number of alerts (assuming that the image-image DIA data products pass all requirements, e.g., characterizing real/bogus), it does not reliably generate scientifically usable light curves for transient objects embedded in their host galaxies (i.e., for cases where the transient is also in the image subtracted).
Image-image differencing may be sufficient for variable star science, even when the difference flux is contaminated by the presence of the object in the earlier image, as it still shows whether a source has changed brightness.
However, additional algorithms might be needed to generate useful light curves \citep[e.g.,][]{2005AJ....130.2272B}.
Given that only 3 images are required to produce a template that will meet LOY1 requirements on the maximum fraction of noise contributed by the template to the difference image (\ref{sssec:potsol_comm_r}), this option is likely to entail  a lot of additional work and risk for little scientific gain.

\clearpage
\subsection{Catalog Differencing}\label{ssec:potsol_catdiff}

{\bf Do not build templates. Do not use DIA. Generate alerts for all new point sources and cataloged point sources that have changed in brightness by more than some threshold since the last image ("catalog differencing").}

\begin{center}
\begin{tabular}{|p{2.5cm}|p{13cm}|}
\hline
Scope & \textcolor{red}{Expansion of scope.}  \\
\hline
Risks & \textcolor{orange}{Potential risks for the DMS.} \\
\hline
Requirements & \textcolor{red}{Violates some formal requirements.} \\
\hline
Consistency & \textcolor{red}{Does not provide consistent data products.} \\
\hline
Science & \textcolor{orange}{Enables some science from DIA and alerts in LOY1.} \\
\hline
\end{tabular}
\end{center}

\textcolor{red}{Scope -- Expansion of scope.}
New software would need to be developed to generate and validate alerts from single-visit image source catalogs, which would constitute a potentially major expansion in scope in terms of FTE hours (but would fit well within scope in terms of computational processing).

\textcolor{orange}{Risks -- Potential risks for the DMS.}
If DIA is not run in LOY1, the risks are the same as the option to Do Nothing in \S~\ref{ssec:potsol_donothing}. 

\textcolor{red}{Requirements -- Violates some formal requirements.}
As this option is similar to image-image differencing (but done with catalog fluxes instead of images), it violates some formal requirements in the same manner as \S~\ref{ssec:potsol_imgimg}. 

\textcolor{red}{Consistency -- Does not provide consistent data products.}
Without DIA, the alert packet contents would be fundamentally different in content in LOY1 (i.e., no difference-image fluxes, no spuriousness parameter, no difference-image stamp).

\textcolor{orange}{Science -- Enables some science from DIA and alerts in LOY1.}
As with image-image differencing in \S~\ref{ssec:potsol_imgimg}, catalog light curves are more scientifically useful for variable stars and asteroids than for supernovae and objects in crowded fields, which would limit the scientific impact of these alerts in LOY1 (despite potentially producing more of them).

\clearpage
\section{Summary and Conclusions}\label{sec:rec}

The option for alert production in LOY1 that would provide the largest potential science impact with {\em no} expansion in DM scope is to only use the template images that will have already been generated as a part of commissioning and science verification.
A very small up-scope option is to re-generate template images from {\em all} of the commissioning data that exists by the start of LOY1, and generate alerts whenever a template exists.
The total sky area and filter coverage of templates that could potentially be built from the commissioning and science verification surveys, and further strategies to maximize LOY1 science by optimizing early surveys for template-building, were discussed in \S~\ref{sssec:potsol_comm_r}.
A further moderate up-scope option is to continue to generate interim template images throughout LOY1 as new data is obtained.
This could add $\sim$1000-2000 $\rm deg^2$ in template images per month.
These options to use commissioning and LOY1 data to generate template images, and to run DIA in LOY1, are also favored because they do not pose a risk to the observatory or the DMS, will not violate any formal requirements, and will provide consistent data products compared to the following 9 years of Operations. 

The options to produce alerts {\it without} proper templates and/or without using DIA, although they might at first seem like an easy solution to maximize the number of alerts in LOY1, would actually require larger expansions of scope and engender more potential risks, and are hence disfavored.
The  option to not produce alerts in LOY1 avoids all potential scope expansions, but is inconsistent with a high-level requirement set forth in the SRD and community expectations, and is not without its own risks, notably,  the missed opportunity to learn lessons about alert production early on, and potentially overloaded computational resources as the science community runs user-generated difference-imaging pipelines, and is hence equally disfavored. 
These disfavored options furthermore fail to provide consistent data products to the users and, in some cases, also violate formal requirements on template images and/or alert contents.

\subsection{The DM System Science Team's Preferred Option for Alerts in LOY1}

Template images should be generated prior to the start of Operations from as much of the LSSTCam commissioning data as possible, and used for DIA and alert production during LOY1.
A "Template-Building Filler Program" that schedules observations which would be beneficial to template-building should be prepared and used by the commissioning team whenever their activities are agnostic to imaging filter and telescope pointing.
Further study -- including input from the science community -- is required to determine the scientific priorities for such a scheduler (e.g., prioritizing area in a single filter {\it vs.} less area covered by multiple filters; maximizing the number of alerts for unique objects {\it vs.} maximizing the amount of LSST information per object).
A moderate up-scope option to build interim templates during LOY1 as new data is acquired should also be attempted by DM on a best-effort basis, as this could increase the sky coverage by $\sim$1000-2000 $\rm deg^2$ per month.

\clearpage
\bibliography{local,lsst,refs,books,refs_ads}

\end{document}
